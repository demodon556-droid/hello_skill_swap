{% extends "layout/base.html" %}

{% load static %}

{% block title %}Courses | Skill Swap {% endblock %}

{% block mainsection %}

    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Courses</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="{% url 'core:home' %}">Home</a></li>
            <li class="current">Courses</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Courses 2 Section -->
    <section id="courses-2" class="courses-2 section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row">
          <div class="col-lg-3">
            <div class="course-filters" data-aos="fade-right" data-aos-delay="100">
              <h4 class="filter-title">Filter Courses</h4>

              <div class="filter-group">
                <h5>Category</h5>
                <div class="filter-options">
                  <label class="filter-checkbox">
                    <input type="checkbox" checked="" data-category="all">
                    <span class="checkmark"></span>
                    All Categories
                  </label>
                  {% for category in categories %}
                  <label class="filter-checkbox">
                    <input type="checkbox" data-category="{{ category.id }}">
                    <span class="checkmark"></span>
                    {{ category.name }}
                  </label>
                  {% endfor %}
                </div>
              </div>

              <div class="filter-group">
                <h5>Level</h5>
                <div class="filter-options">
                  <label class="filter-checkbox">
                    <input type="checkbox" checked="">
                    <span class="checkmark"></span>
                    All Levels
                  </label>
                  <label class="filter-checkbox">
                    <input type="checkbox">
                    <span class="checkmark"></span>
                    Beginner
                  </label>
                  <label class="filter-checkbox">
                    <input type="checkbox">
                    <span class="checkmark"></span>
                    Intermediate
                  </label>
                  <label class="filter-checkbox">
                    <input type="checkbox">
                    <span class="checkmark"></span>
                    Advanced
                  </label>
                </div>
              </div>

              <!-- <div class="filter-group">
                <h5>Duration</h5>
                <div class="filter-options">
                  <label class="filter-checkbox">
                    <input type="checkbox">
                    <span class="checkmark"></span>
                    Under 5 hours
                  </label>
                  <label class="filter-checkbox">
                    <input type="checkbox">
                    <span class="checkmark"></span>
                    5-20 hours
                  </label>
                  <label class="filter-checkbox">
                    <input type="checkbox">
                    <span class="checkmark"></span>
                    20+ hours
                  </label>
                </div>
              </div> -->

              <div class="filter-group">
                <h5>Price</h5>
                <div class="filter-options">
                  <label class="filter-checkbox">
                    <input type="checkbox">
                    <span class="checkmark"></span>
                    Free
                  </label>
                  <label class="filter-checkbox">
                    <input type="checkbox">
                    <span class="checkmark"></span>
                    Paid
                  </label>
                </div>
              </div>
            </div><!-- End Course Filters -->
          </div>

          <div class="col-lg-9">
            <div class="courses-header" data-aos="fade-left" data-aos-delay="100">
              <div class="search-box">
                <i class="bi bi-search"></i>
                <input type="text" id="searchInput" placeholder="Search categories or skills...">
              </div>
              <div class="sort-dropdown">
                <select>
                  <option>Sort by: Most Popular</option>
                  <option>Newest First</option>
                  <option>Price: Low to High</option>
                  <option>Price: High to Low</option>
                  <option>Duration: Short to Long</option>
                </select>
              </div>
            </div>

            <div class="courses-grid" data-aos="fade-up" data-aos-delay="200" id="coursesGrid">
              <div class="row">
                {% for skill in skills %}
                <div class="col-lg-6 col-md-6 course-item" data-category="{{ skill.category.id }}" data-skill-name="{{ skill.name|lower }}" data-category-name="{{ skill.category.name|lower }}">
                  <div class="course-card">
                    <div class="course-image">
                      {% if skill.image %}
                        <img src="{{ skill.image.url }}" alt="{{ skill.name }}" class="img-fluid">
                      {% else %}
                        <img src="{% static 'assets/img/education/courses-3.webp' %}" alt="{{ skill.name }}" class="img-fluid">
                      {% endif %}
                      <div class="course-badge">{{ skill.category.name }}</div>
                    </div>
                    <div class="course-content">
                      <div class="course-meta">
                        <span class="category">{{ skill.category.name }}</span>
                        <span class="level">All Levels</span>
                      </div>
                      <h3>{{ skill.name }}</h3>
                      <p>{{ skill.description|truncatewords:20 }}</p>
                      <div class="course-stats">
                        <div class="stat">
                          <i class="bi bi-calendar"></i>
                          <span>Added {{ skill.created_at|date:"M d, Y" }}</span>
                        </div>
                        <div class="stat">
                          <i class="bi bi-people"></i>
                          <span>Learn this skill</span>
                        </div>
                      </div>
                      <a href="{% url 'core:enroll' %}" class="btn-course">Start Learning</a>
                    </div>
                  </div><!-- End Course Card -->
                </div>
                {% empty %}
                <div class="col-12">
                  <div class="text-center py-5">
                    <h4>No skills available at the moment</h4>
                    <p>Please check back later for new courses and skills.</p>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div><!-- End Courses Grid -->

            <div class="pagination-wrapper" data-aos="fade-up" data-aos-delay="300">
              <nav aria-label="Courses pagination">
                <ul class="pagination justify-content-center">
                  <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                      <i class="bi bi-chevron-left"></i>
                    </a>
                  </li>
                  <li class="page-item active">
                    <a class="page-link" href="#">1</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#">2</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#">3</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#">
                      <i class="bi bi-chevron-right"></i>
                    </a>
                  </li>
                </ul>
              </nav>
            </div><!-- End Pagination -->

          </div>
        </div>

      </div>

    </section><!-- /Courses 2 Section -->

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const categoryCheckboxes = document.querySelectorAll('input[data-category]');
    const courseItems = document.querySelectorAll('.course-item');
    
    // Filter function
    function filterCourses() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        const selectedCategories = Array.from(categoryCheckboxes)
            .filter(checkbox => checkbox.checked)
            .map(checkbox => checkbox.getAttribute('data-category'));
        
        // If "All Categories" is selected, show all categories
        const showAllCategories = selectedCategories.includes('all');
        
        courseItems.forEach(item => {
            const skillName = item.getAttribute('data-skill-name');
            const categoryName = item.getAttribute('data-category-name');
            const categoryId = item.getAttribute('data-category');
            
            // Check search criteria
            const matchesSearch = !searchTerm || 
                skillName.includes(searchTerm) || 
                categoryName.includes(searchTerm);
            
            // Check category criteria
            const matchesCategory = showAllCategories || 
                selectedCategories.includes(categoryId);
            
            // Show/hide item
            if (matchesSearch && matchesCategory) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
        
        // Show message if no courses match
        const visibleCourses = Array.from(courseItems).filter(item => 
            item.style.display !== 'none'
        );
        
        const coursesGrid = document.getElementById('coursesGrid');
        let noResultsMsg = coursesGrid.querySelector('.no-results-message');
        
        if (visibleCourses.length === 0) {
            if (!noResultsMsg) {
                noResultsMsg = document.createElement('div');
                noResultsMsg.className = 'col-12 no-results-message';
                noResultsMsg.innerHTML = `
                    <div class="text-center py-5">
                        <h4>No courses found</h4>
                        <p>Try adjusting your search criteria or filters.</p>
                    </div>
                `;
                coursesGrid.querySelector('.row').appendChild(noResultsMsg);
            }
            noResultsMsg.style.display = 'block';
        } else {
            if (noResultsMsg) {
                noResultsMsg.style.display = 'none';
            }
        }
    }
    
    // Category filter logic
    categoryCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            // Handle "All Categories" checkbox
            if (this.getAttribute('data-category') === 'all') {
                if (this.checked) {
                    // Uncheck all other category checkboxes
                    categoryCheckboxes.forEach(cb => {
                        if (cb !== this) {
                            cb.checked = false;
                        }
                    });
                }
            } else {
                // If any specific category is checked, uncheck "All Categories"
                if (this.checked) {
                    const allCategoriesCheckbox = document.querySelector('input[data-category="all"]');
                    if (allCategoriesCheckbox) {
                        allCategoriesCheckbox.checked = false;
                    }
                }
                
                // If no specific categories are checked, check "All Categories"
                const specificCategoriesChecked = Array.from(categoryCheckboxes)
                    .filter(cb => cb.getAttribute('data-category') !== 'all' && cb.checked);
                
                if (specificCategoriesChecked.length === 0) {
                    const allCategoriesCheckbox = document.querySelector('input[data-category="all"]');
                    if (allCategoriesCheckbox) {
                        allCategoriesCheckbox.checked = true;
                    }
                }
            }
            
            filterCourses();
        });
    });
    
    // Search functionality
    searchInput.addEventListener('input', filterCourses);
    
    // Initial filter application
    filterCourses();
});
</script>
{% endblock %}